# 概率

## 随机游走

### 有限图上的随机游走

定义：

1. $p_{uv}$表示当前在$u$，下一步在$v$的概率。
2. 转移矩阵$P$的第$i$行第$j$列元素为$p_{ji}$。
3. $p^{(k)}_{uv}$表示当前在$u$，$k$步后在$v$的概率。
4. k步转移矩阵$P^{k}$第$i$行第$j$列元素为$p^{(k)}_{ji}$。
5. $p^{(k)}_{uv}=\sum_{w \in N(u)}{p_{uw}p^{k-1}_{wv}}$
6. $X^{(0)}$为初始态列向量，$X^{(0)}_u$为初始状态时点在$u$的概率。
7. $X^{(k)}=P^kX^{(0)}$为进行$k$次转移后的状态。

期望问题：计算从一些点（给定概率）出发到达某个终末点$t$的期望步数/消耗。

注：在这个问题中，无论原图如何，都需要将$t$点的出边删去并指向虚空，即$\forall u \in V, p_{tu}=0$。

但特别的，有$p^{(0)}_{tt}=1$

设$P(u)$为从$u$出发，经过无限步后到达$t$的概率。特别的$P(t)=1$。

$$P(u)=\sum_{k=1}^{\infty}{p^{(k)}_{ut}}=\sum_{k=1}^{\infty}{\sum_{v \in N(u)}{p_{uv}p^{(k-1)}_{vt}}}=\sum_{v\in N(u)}{p_{uv}\sum_{k=1}^{\infty}}{p^{(k-1)}_{vt}{}}$$
$$=p_{vt}+\sum_{t \neq v \in N(u)}{p_{uv}P(v)}=\sum_{v \in N(u)}{p_{uv}P(v)}$$

设$E(u)$为从$u$出发，到达$t$的期望转移次数。特别的，$E(t)=0$。

$$E(u)=\sum_{k=1}^{\infty}{kp^{(k)}_{ut}}=\sum_{k=1}^{\infty}{k\sum_{v \in N(u)}{p_{uv}p^{(k-1)}_{vt}}}=\sum_{v \in N(u)}{p_{uv}\sum_{k=1}^{\infty}{kp^{(k-1)}_{vt}}}$$

$$=p_{ut}+\sum_{t \neq v \in N(u)}{p_{uv}\sum_{k=1}^{\infty}{(k+1)p^{(k)}_{vt}}}=p_{ut}+\sum_{t\neq v \in N(u)}{p_{uv}\left(\sum_{k=1}^{\infty}{kp_{vt}}+\sum_{k=1}^{\infty}{p_{vt}}\right)}$$

$$=p_{ut}+\sum_{t \neq v \in N(u)}{p_{uv}(E(v)+P(v))}=\sum_{v \in N(u)}{p_{uv}(P(v)+E(v))}$$

设$F(u)$为从$u$出发，到达$t$的期望消耗。其中第$k$步的消耗为$k$。特别的，$F(t)=0$。

$$F(u)=\sum_{k=1}^{\infty}{\frac{k(k+1)}{2}p^{(k)}_{ut}}=\sum_{k=1}^{\infty}{\frac{k(k+1)}{2}\sum_{v \in N(u)}{p_{uv}p^{(k-1)}_{vt}}}=\sum_{v \in N(u)}{p_{uv}\sum_{k=1}^{\infty}{\frac{k(k+1)}{2}p^{(k-1)}_{vt}}}$$

$$=p_{ut}+\sum_{n \neq v \in N(u)}{p_{uv}\sum_{k=1}^{\infty}{\frac{k(k+1)}{2}p^{(k-1)}_{vt}}}=p_{ut}+\sum_{n \neq v \in N(u)}{p_{uv}\sum_{k=1}^{\infty}{\frac{(k+1)(k+2)}{2}p^{(k)}_{vt}}}$$

$$=p_{ut}+\sum_{n \neq v \in N(u)}{p_{uv}\sum_{k=1}^{\infty}{\left[\frac{k(k+1)}{2}+k+1\right]p^{(k)}_{vt}}}=p_{ut}+\sum_{n \neq v \in N(u)}{p_{uv}\left[\sum_{k=1}^{\infty}{\frac{k(k+1)}{2}p^{(k)}_{vt}}+\sum_{k=1}^{\infty}{kp^{(k)}_{vt}}+\sum_{k=1}^{\infty}{p^{(k)}_{vt}}\right]}$$

$$=p_{ut}+\sum_{n\neq v \in N(u)}{p_{uv}[F(u)+E(u)+P(u)]}=\sum_{v \in N(u)}{p_{uv}[F(u)+E(u)+P(u)]}$$

### 无限图上的随机游走
