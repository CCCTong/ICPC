# 组合数学

## 容斥原理与子集卷积

### Zeta变换与Moebius变换

定义1：

$$(\zeta f)(S)=\sum_{T \subseteq S}{f(T)}$$

$$(\mu f)(S)=\sum_{T \subseteq S}{(-1)^{|S|-|T|}f(T)}$$

定理1：

$$(\mu \zeta f)(S) = (\zeta \mu f)(S)=f(S)$$

也可写作：

$$ g(S)=\sum_{T\subseteq S}{f(T)}\Rightarrow f(S)=\sum_{T\subseteq S}{(-1)^{|S|-|T|}g(T)}$$

证明1：

$$
(\mu \zeta f)(S)
=\sum_{T \subseteq S}{(\zeta f)(T)}
=\sum_{T\subseteq S}{(-1)^{|S|-|T|}\sum_{U\subseteq T}{f(U)}}
$$
$$
=\sum_{U\subseteq S}{f(U)\sum_{U\subseteq T \subseteq S}{(-1)^{|S|-|T|}}}
=\sum_{U\subseteq S}{f(U)\sum_{V\subseteq S-U}{(-1)^{|V|}}}
$$
$$
=\sum_{U\subseteq S}{f(U)[|S]-|U|=0]}
=f(S)
$$

注：同时有

$$ 
    g(S)=\sum_{T \supseteq S}{f(T)}\Rightarrow f(S)=\sum_{T\supseteq S}{(-1)^{|T|-|S|}g(T)}
$$

定义2：容斥原理背景

设有许多性质$P_i$,性质的全集为$U$, $A_i=\{x|P_i(x)\}$表示满足第$i$个性质的集合

对于一些性质的集合$S$,定义

$$f(S)=\{x|\exist i \in S,P_i(x)\}=\left|\bigcup_{i\in S}{A_i}\right|$$

$$g(S)=\{x|\forall i \in S, P_i(x)\}=\left|\bigcap_{i\in S}{A_i}\right|$$

$$ h(S)=\{x|(\forall i \in S, P_i(x))\wedge(\forall i \notin S, \neg P_i(x)\} 
=\left|\bigcap_{i\in S}{A_i}-\bigcup_{i\notin S}{A_i}\right|
$$

则由定义有：

$$ f(U)=\sum_{\emptyset \neq S\subseteq U}{h(S)}$$

$$ g(T)=\sum_{S \supseteq T}{h(S)}$$

定理2：容斥原理

$$ f(U)=\sum_{\emptyset \neq T \subseteq U} {(-1)^{|T|+1}g(T)}$$

证明2：

$$
f(U)=\sum_{\emptyset \neq S \subseteq U}{h(S)}
=\sum_{\emptyset \neq S \subseteq U}{\sum_{T\supseteq S}{(-1)^{|T|-|S|}g(T)}}
=\sum_{\emptyset \neq T \subseteq U}{(-1)^{|T|}g(T)\sum_{\emptyset \neq S\subseteq T}{(-1)^{|S|}}}
$$
$$
=\sum_{\emptyset \neq T \subseteq U}{(-1)^{|T|}g(T)}(\sum_{S\subseteq T}{(-1)^{|S|}-(-1)^{|\emptyset |})}
=\sum_{\emptyset \neq T \subseteq U}{(-1)^{|T|+1}g(T)}
$$

## 生成函数

### 一般生成函数

定义：一个序列$\{a_i\}$的生成函数为$$F(x)=\sum_{i=0}^{\infty}{a_ix^i}$$

易得两个生成函数的乘积即为对应序列的卷积：

$$H(x)=F(x)G(x)=\sum_{i=0}^{\infty}{c_ix^i}=\sum_{i=0}^\infty{\left(\sum_{j=0}^{i}{a_jb_{i-j}}\right)x^i}$$

即

$$c_i=\sum_{j=0}^{i}{a_jb_{i-j}}$$

注：一般生成函数的系数可看作某种组合方案，两个一般生成函数的卷积的第$i$项系数的意义（即上式）可看作对从第一个集合中选$j$个，第二个集合中选$i-j$个的组合的方案数求和。

### 指数生成函数

定义：一个序列$\{a_i\}$的指数生成函数(EGF)为$$F(x)=\sum_{i=0}^{\infty}{a_i\frac{x^i}{i!}}$$

易得两个指数生成函数的乘积即为对应序列的带二项式系数的卷积：

$$H(x)=F(x)G(x)=\sum_{i=0}^{\infty}{c_i\frac{x^i}{i!}}
$$
$$
=\sum_{i=0}^\infty{\left(\sum_{j=0}^{i}{i!\frac{a_j}{j!}\frac{b_{i-j}}{(i-j)!}}\right)\frac{x^i}{i!}}=\sum_{i=0}^\infty{\left(\sum_{j=0}^i{\binom{i}{j}a_jb_{i-j}}\right)\frac{x^i}{i!}}
$$

即

$$c_i=\sum_{j=0}^{i}{\binom{i}{j}a_jb_{i-j}}$$

注：指数生成函数的系数可看作某种排列方案，两个指数生成函数的卷积的第$i$项系数的意义（即上式）可看作对从第一个集合中选$j$个，第二个集合中选$i-j$个，并将i个位只中的j个钦定为从第一个集合中选出来的，余下$i-j$个钦定为从第二个集合中选出来的的所有排列的方案数求和。（因此有个组合数作为系数）


### $e^{F(x)}$的组合意义

定义：合法集合与合法划分

将满足某些性质的集合定义为合法集合。
将一个集合划分为多个合法集合的划分方案定义为合法划分。

若$F(x)$为表示大小为$n$的合法集合有多少种的生成函数，则$\frac{F(x)^k}{k!}$为将大小为$n$的集合划分为$k$份合法集合的合法划分数的生成函数。

如大小为$n$的无向图有$2^{\frac{1}{2}n(n-1)}$种，则对应的合法集合可设为大小为$n$的连通图。枚举划分为的集合数并求和可得到

$$G(x)=\sum_{k=0}^\infty{\frac{F(x)^k}{k!}}$$

即$G(x)=e^{F(x)}$，或$F(x)=lnG(x)$

### 常见数列的生成函数

$$Fibonacci_i: F(x)=1+xF(x)+x^2F(x)\Rightarrow F(x)=\frac{1}{1-x-x^2}$$

$$Catalan_i: F(x)=1+xF(x)^2 \Rightarrow F(x)=\frac{1-\sqrt{1-4x}}{2x}=\frac{1-(1-4x)}{2x(1+\sqrt{1-4x})}=\frac{2}{1+\sqrt{1-4x}}$$

## 常见计数序列

### 二项式系数

定义：

$$\binom{n}{k}=\frac{n!}{k!(n-k)!}$$

常见恒等式：

$$\binom{n}{k}=\binom{n-1}{k-1}+\binom{n-1}{k}$$

$$\binom{n}{k}=\frac{n}{k}\binom{n-1}{k-1}$$

$$\sum_{k=0}^n{\binom{m+k}{k}}=\binom{m+n+1}{n}$$

$$\sum_{k=0}^n{\binom{k}{m}}=\binom{n+1}{m+1}$$

$$\sum_{k=0}^{n}{\binom{m_1}{k}\binom{m_2}{n-k}}=\binom{m_1+m_2}{n}$$

### 卡特兰数

### 第一类斯特林数

定义：$S_1(n,m)$表示将大小为$n$的集合划分成$m$个圆排列的方案数

考虑$n$所在排列（加入某个圆排列或单独作为一个新的圆排列）可得到递推式：

$$S_1(n,m)=S_1(n-1,m-1)+nS_1(n,m)$$

特别的，$S_1(n,0)=[n==0]$

注：每个圆排列可被视作一个置换，因而$$\sum_{k=0}^n{S_1(n,k)}=n!$$

### 第二类斯特林数

定义：$S_2(n,m)$表示将大小为$n$的集合划分成$m$个非空集合的方案数

考虑$n$所在集合（加入$m$个集合中的一个或单独作为一个新的集合）可得到递推式：

$$S_2(n,m)=S_2(n-1,m-1)+mS_2(n-1,m)$$

## 图计数

### 有标号有根树计数

### 无标号有根树计数

### 有标号无根树计数

### 无标号无根树计数

### 有标号基环树计数

### 有标号连通图计数

对于满足某些性质的图（如欧拉图，即顶点度数均为偶数），用可以不连通的所有方案推广到连通的所有方案的情况可通过将所有方案减去不连通的方案获得。如枚举$1$号点所在连通块大小$k$，则除$1$号点之外的点共有$\binom{n-1}{k-1}$种方案：

$$f_n=g_n-\sum_{k=1}^{n-1}{\binom{n-1}{k-1}f_kg_{n-k}}$$

也可通过指数生成函数进行计数，即$G(x)=lnF(x)$见“$e^{F(x)}$的组合意义”

### 有标号双连通图计数

设大小为$n$的双连通图数量为$F(n)$，大小为$n$的连通图数量为$G(n)$

设$1$号点所在双连通分量大小为$k$

$F(n,S)=$

### 有标号二分图计数

设大小为$n$，有$m$个连通块的二分图数量为$F(n,m)$，则有：

$$F(n,m)=\sum_{k=1}^{n-m+1}{\binom{n-1}{k-1}F(k,1)F(n-k,m-1)}$$

设$G(n)$为大小为$n$，进行了黑白染色的二分图数量，则有:

$$G(n)=\sum_{m=0}^n{\binom{n}{m}2^{m(n-m)}}=\sum_{m=1}^n{2^mF(n,m)}$$

$$=2^1F(n,1)+\sum_{m=2}^n{2^m\sum_{k=1}^{n-m+1}{\binom{n-1}{k-1}F(k,1)F(n-k,m-1)}}$$

$$=2F(n,1)+\sum_{k=1}^{n-1}{\binom{n-1}{k-1}F(k,1)\sum_{m=2}^{n-k+1}{2^mF(n-k,m-1)}}$$

$$=2F(n,1)+2\sum_{k=1}^{n-1}{\binom{n-1}{k-1}F(k,1)\sum_{m=1}^{n-k}{2^mF(n-k,m)}}$$

$$=2F(n,1)+2\sum_{k=1}^{n-1}{\binom{n-1}{k-1}F(k,1)G(n-k)}$$

可得递推式:

$$F(n,1)=\frac{1}{2}G(n)-\sum_{k=1}^{n-1}{\binom{n-1}{k-1}{F(k,1)G(n-k)}}$$

注：
$$G(n)=\sum_{m=0}^n{\binom{n}{m}2^{m(n-m)}}=\sum_{m=0}^n{\binom{n}{m}2^{nm-m^2}}
=\sum_{m=0}^n{\frac{n!}{m!(n-m)!}2^{\frac{1}{2}(n^2+m^2-(n-m)^2)-m^2}}$$
$$=n!2^\frac{n^2}{2}\sum_{m=0}^n{\frac{1}{m!(n-m)!}2^{-\frac{(n-m)^2}{2}-\frac{m^2}{2}}}
=n!2^\frac{n^2}{2}\sum_{m=0}^n{\frac{2^{-\frac{(n-m)^2}{2}}}{m!}\frac{2^{-\frac{m^2}{2}}}{(n-m)!}}$$

考虑$n$个点的二染色的连通二分图的EGF为$H(x)$，二染色的二分图的EGF为$G(x)$，连通二分图的EGF为$F_1(x)$，二分图的EGF为$F_2(x)$，则显然$G(x)=e^{H(x)}$，且$H(x)=2F_1(x)$,$F_2(x)=e^{F_1(x)}$。

于是$F_2(x)=e^{F_1(x)}=e^{\frac{1}{2}H(x)}=e^{\frac{1}{2}lnG(x)}=\sqrt{G(x)}$。

### 有标号DAG计数

注意到DAG中存在一类特殊的点，即出度为$0$的点，我们通过枚举这些点进行计算。

设$F(n,S)$为$n$个点，有且仅有$S$中点出度为0的DAG数量。

设$G(n,S)$为$n$个点，至少有$S$中点出度为0的DAG数量。不难发现我们需要求的即是$G(n,\emptyset)$。

枚举$S$中点与其他点的连边，可得$G(n,S)=2^{|S|(n-|S|)}G(n-|S|,\emptyset)$

由$G$与$F$的定义可得

$$G(n,S)=\sum_{T \supseteq S}{F(n,T)}$$

$$F(n,S)=\sum_{T \supseteq S}{(-1)^{|T|-|S|}G(n,T)}$$

于是有

$$G(n,\emptyset)=\sum_{T \neq \emptyset}{F(n,T)}=\sum_{T \neq \emptyset}{\sum_{S\supseteq T}{(-1)^{|S|-|T|}G(n,S)}}$$

$$=\sum_{T \neq \emptyset}{\sum_{S\supseteq T}{(-1)^{|S|-|T|}2^{|S|(n-|S|)}G(n-|S|,\emptyset)}}$$

$$=\sum_{S\neq \emptyset}{(-1)^{|S|}2^{|S|(n-|S|)}G(n-|S|,\emptyset)\sum_{\emptyset \neq T\subseteq S}}{(-1)^{|T|}}$$

$$=\sum_{k=1}^{n}{\binom{n}{k}(-1)^{k-1}2^{k(n-k)}}G(n-k,\emptyset)$$

注：考虑上式的组合意义：

$n$个点的DAG数量$=$至少$1$个点出度为$0$的DAG数量$-$至少$2$个点出度为$0$的DAG数量$+$至少$3$个点出度为$0$的DAG数量。。。

### 有标号强连通图计数

设大小为$n$的强连通图数量为$F(n)$，考虑用所有$n$个点的有向图的个数$H(n)$减去非强连通图的方案数来计算答案。

考虑DAG计数的过程，我们枚举非强连通图缩点后出度为$0$的强连通分量由哪些点组成，其他点与这些点之间可以任意连边。

$$F(n)=H(n)-\sum_{k=1}^{n}{\binom{n}{k}2^{k(n-k)}}$$

设$G(n,k)$表示$n$个点组成$k$个互不相连的强连通分量的方案数，并令$G(n)$
