---
title: "数据结构-树剖/Splay/LCT"
author: forgottencsc
date: Oct 9, 2019
geometry: margin=2cm
output: pdf_document
---

## 树剖

### 重链剖分

### 长链剖分

## Splay(BST)

```cpp
int ch[3][N], sz[N], nc;
int *ls = ch[0], *rs = ch[1], *fa = ch[2];
int val[N];

int gn(int v) {
    int p = ++nc;
    ls[p] = rs[p] = fa[p] = 0;
    val[p] = v; sz[p] = 1;
    return p;
}

void push_up(int x) {
    sz[x] = sz[ls[x]] + sz[rs[x]] + 1;
}

bool isr(int x) { return !fa[x]; }
int id(int x) { return ch[1][fa[x]] == x; }

void rot(int x) {
    int y = fa[x], z = fa[y], o = id(x), w = ch[!o][x];
    fa[x] = z; if (!isr(x)) ch[id(y)][z] = x;
    ch[o][y] = w; if (w) fa[w] = y;
    ch[!o][x] = y; fa[y] = x;
    push_up(y); push_up(x);
}

void splay(int x) {
    for (int y; !isr(x); rot(x)) if (!isr(y = fa[x])) rot(id(x)^id(y)?x:y);
}

void find_lwr(int& r, int v) {
    int x = r, y = -1;
    while (x) {
        if (val[x] >= v) y = x;
        x = ch[val[x] < v][x];
    }
    if (y != -1) splay(y), r = y;
}

void find_upr(int& r, int v) {
    int x = r, y = -1;
    while (x) {
        if (val[x] > v) y = x;
        x = ch[val[x] <= v][x];
    }
    if (y != -1) splay(y), r = y;
}

int get_rank(int x) { return sz[ls[x]] + 1; }

void find_kth(int& r, int k) {
    int x = r, y = -1;
    while (y == -1) {
        int cnt = sz[ls[x]];
        if (cnt >= k) x = ls[x];
        else if (cnt == k - 1) y = x;
        else x = rs[x], k -= cnt + 1;
    }
    splay(y); r = y;
}

void ins(int& r, int v) {
    int* p = &r, x;
    while (*p) x = *p, p = &ch[val[x] < v][x];
    int y = *p = gn(v); fa[y] = x;
    splay(y); r = y;
}

void del(int& r, int x) {
    if (ls[x]) {
        int y = ls[x]; while (rs[y]) y = rs[y];
        splay(y); r = y;
    }
    if (!fa[x]) {
        r = rs[x]; if (rs[x]) fa[rs[x]] = 0;
    }
    else {
        ch[id(x)][fa[x]] = rs[x];
        fa[rs[x]] = fa[x];
        int y = rs[x];
        splay(y); r = y;
    }
}

void pred(int& r, int v) {
    find_lwr(r, v);
    int x = ls[r]; while (rs[x]) x = rs[x];
    splay(x); r = x;
}

void succ(int& r, int v) {
    find_upr(r, v);
}
```
